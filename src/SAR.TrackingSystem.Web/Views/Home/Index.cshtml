@model SAR.TrackingSystem.Web.Models.DashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
}

<div class="row">
    <div class="col-md-12">
        <h1 class="mb-4">
            <i class="bi bi-speedometer2 text-primary"></i>
            GÃ¶sterge Paneli
        </h1>
    </div>
</div>

@if (ViewBag.Error != null)
{
    <div class="alert alert-danger">
        <i class="bi bi-exclamation-triangle"></i>
        @ViewBag.Error
    </div>
}

<div id="dashboard-content">
    @await Html.PartialAsync("_DashboardContent", Model)
</div>

@section Scripts {
    <script>
        let refreshInterval;
        
        function refreshDashboard() {
            fetch('/Home/GetDashboardData')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('dashboard-content').innerHTML = html;
                    console.log('Dashboard updated:', new Date().toLocaleTimeString());
                })
                .catch(error => {
                    console.error('Dashboard refresh failed:', error);
                });
        }
        
        // Start auto-refresh every 30 seconds
        refreshInterval = setInterval(refreshDashboard, 30000);
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
        });
    </script>
}
